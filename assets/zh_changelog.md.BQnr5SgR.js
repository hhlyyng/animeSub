import{_ as a,o as t,c as d,a2 as o}from"./chunks/framework.D3n7QxxD.js";const m=JSON.parse('{"title":"更新日志","description":"","frontmatter":{},"headers":[],"relativePath":"zh/changelog.md","filePath":"zh/changelog.md"}'),i={name:"zh/changelog.md"};function r(l,e,n,c,h,s){return t(),d("div",null,[...e[0]||(e[0]=[o('<h1 id="更新日志" tabindex="-1">更新日志 <a class="header-anchor" href="#更新日志" aria-label="Permalink to &quot;更新日志&quot;">​</a></h1><h2 id="_2026-02-05" tabindex="-1">2026-02-05 <a class="header-anchor" href="#_2026-02-05" aria-label="Permalink to &quot;2026-02-05&quot;">​</a></h2><h3 id="修复-bangumi-token-可选化" tabindex="-1">修复：Bangumi Token 可选化 <a class="header-anchor" href="#修复-bangumi-token-可选化" aria-label="Permalink to &quot;修复：Bangumi Token 可选化&quot;">​</a></h3><p>经 API 测试确认，Bangumi 公开端点（每日放送、评分排行、条目详情）无需认证。</p><p><strong>变更</strong>：</p><ul><li>Bangumi Token 改为可选，缺少时直接使用公开 API，不再返回 401/400 错误</li><li>API 端点从 <code>POST /v0/search/subjects</code> 改为 <code>GET /v0/subjects?type=2&amp;sort=rank</code></li></ul><h3 id="新增-数据库-schema" tabindex="-1">新增：数据库 Schema <a class="header-anchor" href="#新增-数据库-schema" aria-label="Permalink to &quot;新增：数据库 Schema&quot;">​</a></h3><p>系统使用 SQLite 数据库持久化存储，主要数据表：</p><table tabindex="0"><thead><tr><th>表名</th><th>说明</th></tr></thead><tbody><tr><td><code>AnimeInfo</code></td><td>聚合动漫信息（标题、评分、图片、链接）</td></tr><tr><td><code>AnimeImages</code></td><td>图片缓存（海报、背景图）</td></tr><tr><td><code>Subscriptions</code></td><td>订阅配置</td></tr><tr><td><code>DownloadHistory</code></td><td>下载历史（按 TorrentHash 去重）</td></tr><tr><td><code>DailyScheduleCache</code></td><td>每日放送缓存</td></tr></tbody></table><hr><h2 id="_2026-02-04" tabindex="-1">2026-02-04 <a class="header-anchor" href="#_2026-02-04" aria-label="Permalink to &quot;2026-02-04&quot;">​</a></h2><h3 id="新增-top-10-排行功能" tabindex="-1">新增：Top 10 排行功能 <a class="header-anchor" href="#新增-top-10-排行功能" aria-label="Permalink to &quot;新增：Top 10 排行功能&quot;">​</a></h3><p>新增三个 API 端点，展示不同信源的 Top 10 动漫：</p><table tabindex="0"><thead><tr><th>端点</th><th>数据来源</th></tr></thead><tbody><tr><td><code>GET /api/anime/top/bangumi</code></td><td>Bangumi 评分排行</td></tr><tr><td><code>GET /api/anime/top/anilist</code></td><td>AniList 趋势排行</td></tr><tr><td><code>GET /api/anime/top/mal</code></td><td>MyAnimeList via Jikan API</td></tr></tbody></table><p>前端主页新增 3 个横向滚动 AnimeFlow 卡片区域。</p><h3 id="新增-预取架构" tabindex="-1">新增：预取架构 <a class="header-anchor" href="#新增-预取架构" aria-label="Permalink to &quot;新增：预取架构&quot;">​</a></h3><p>将后端从实时 API 聚合改为预取 + 增量更新架构：</p><ul><li>响应时间从 3–10 秒优化到 <strong>&lt;100ms</strong></li><li>后台 <code>AnimePreFetchService</code> 每日凌晨 3 点批量预取全周数据</li><li>新增管理 API：<code>GET /api/admin/prefetch/status</code>、<code>POST /api/admin/prefetch</code></li></ul><h3 id="新增-tmdb-匹配优化" tabindex="-1">新增：TMDB 匹配优化 <a class="header-anchor" href="#新增-tmdb-匹配优化" aria-label="Permalink to &quot;新增：TMDB 匹配优化&quot;">​</a></h3><ul><li><strong>动画优先</strong>：优先选择 Animation 类型（genre_id=16），避免真人剧污染结果</li><li><strong>日本出品优先</strong>：同等条件下优先 origin_country=JP</li><li><strong>多季度匹配</strong>：利用 Bangumi <code>air_date</code> 年份过滤，匹配对应季度专属图片</li><li><strong>中文简介备选</strong>：Bangumi 简介为空时自动使用 TMDB 中文翻译</li></ul><h3 id="新增-mikan-rss-订阅系统" tabindex="-1">新增：Mikan RSS 订阅系统 <a class="header-anchor" href="#新增-mikan-rss-订阅系统" aria-label="Permalink to &quot;新增：Mikan RSS 订阅系统&quot;">​</a></h3><p>完整的订阅与自动下载功能：</p><ul><li>订阅管理 CRUD（9 个 REST API 端点）</li><li>后台 <code>RssPollingService</code>（每 30 分钟轮询）</li><li>关键词包含/排除过滤、字幕组筛选</li><li>TorrentHash 去重，防止重复下载</li><li>qBittorrent WebUI 集成</li></ul><hr><h2 id="_2026-02-03" tabindex="-1">2026-02-03 <a class="header-anchor" href="#_2026-02-03" aria-label="Permalink to &quot;2026-02-03&quot;">​</a></h2><h3 id="修复-backend-运行时-bug" tabindex="-1">修复：Backend 运行时 Bug <a class="header-anchor" href="#修复-backend-运行时-bug" aria-label="Permalink to &quot;修复：Backend 运行时 Bug&quot;">​</a></h3><p>修复重构后的多个运行时问题：</p><table tabindex="0"><thead><tr><th>问题</th><th>修复方案</th></tr></thead><tbody><tr><td>DI 生命周期冲突（Singleton 依赖 Scoped）</td><td><code>AnimeCacheService</code> 改为 Scoped</td></tr><tr><td>响应开始后修改 Headers 导致异常</td><td>添加 <code>HasStarted</code> 检查</td></tr><tr><td>HttpClient BaseAddress 路径被覆盖</td><td>确保 BaseAddress 以 <code>/</code> 结尾，相对 URL 不以 <code>/</code> 开头</td></tr><tr><td>SQLite 外键约束失败</td><td>移除 AnimeImages → AnimeInfo 外键，两表独立存储</td></tr></tbody></table><hr><h2 id="_2026-02-02" tabindex="-1">2026-02-02 <a class="header-anchor" href="#_2026-02-02" aria-label="Permalink to &quot;2026-02-02&quot;">​</a></h2><h3 id="新增-animedetailmodal-优化" tabindex="-1">新增：AnimeDetailModal 优化 <a class="header-anchor" href="#新增-animedetailmodal-优化" aria-label="Permalink to &quot;新增：AnimeDetailModal 优化&quot;">​</a></h3><ul><li>Modal 仅模糊主内容区，Sidebar 保持清晰（通过 Zustand 共享状态）</li><li>使用 <code>createPortal</code> 渲染到 <code>document.body</code>，脱离父元素样式影响</li><li>布局改为上下结构（信息区 + 下载源区）</li><li>根据全局语言设置显示对应语言的标题和简介，支持 fallback</li></ul><h3 id="修复-sidebar-与标题对齐" tabindex="-1">修复：Sidebar 与标题对齐 <a class="header-anchor" href="#修复-sidebar-与标题对齐" aria-label="Permalink to &quot;修复：Sidebar 与标题对齐&quot;">​</a></h3><p>为 <code>.sidebar-header</code> 添加 <code>items-center</code>，修复 toggle 按钮图标与 &quot;Anime-Sub&quot; 文字垂直不对齐问题。</p><h3 id="重构-前端间距样式" tabindex="-1">重构：前端间距样式 <a class="header-anchor" href="#重构-前端间距样式" aria-label="Permalink to &quot;重构：前端间距样式&quot;">​</a></h3><ul><li>合并 <code>index.css</code> 中重复的 <code>.sidebar-header</code> 定义</li><li>新增 <code>.content-header</code> CSS 类，统一管理主内容区顶部间距</li><li>Sidebar 标题与主内容标题对齐（均使用 <code>pt-16</code> = 64px）</li></ul>',36)])])}const b=a(i,[["render",r]]);export{m as __pageData,b as default};

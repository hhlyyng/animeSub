# Configuration Reference

AnimeSub configuration is written to `appsettings.runtime.json` by the setup wizard, stored in the Docker volume at `/app/data/`. You can also edit the file directly (restart the container after changes).

## QBittorrent

qBittorrent WebUI connection settings.

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `Host` | string | `localhost` | qBittorrent host (IP or hostname) |
| `Port` | int | `8080` | WebUI port |
| `Username` | string | `admin` | WebUI login username |
| `Password` | string | `""` | WebUI login password |
| `Category` | string | `anime` | Download task category label |
| `DefaultSavePath` | string? | `null` | Default save path (uses qBittorrent default if empty) |
| `UseAnimeSubPath` | bool | `false` | Create subdirectory per anime series |
| `PauseTorrentAfterAdd` | bool | `false` | Pause torrent after adding (useful for manual management) |
| `TimeoutSeconds` | int | `30` | Request timeout in seconds |

**Example**:

```json
{
  "QBittorrent": {
    "Host": "192.168.1.100",
    "Port": 8080,
    "Username": "admin",
    "Password": "mypassword",
    "Category": "anime",
    "DefaultSavePath": "/downloads/anime",
    "PauseTorrentAfterAdd": false,
    "TimeoutSeconds": 30
  }
}
```

## Mikan

Mikan RSS feed configuration.

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `BaseUrl` | string | `https://mikanani.me` | Mikan base URL |
| `PollingIntervalMinutes` | int | `30` | RSS polling interval in minutes |
| `EnablePolling` | bool | `true` | Enable background auto-polling |
| `MaxSubscriptionsPerPoll` | int | `50` | Maximum subscriptions processed per poll cycle |
| `TimeoutSeconds` | int | `30` | Request timeout in seconds |
| `StartupDelaySeconds` | int | `30` | Delay before first poll after startup |

**Example**:

```json
{
  "Mikan": {
    "BaseUrl": "https://mikanani.me",
    "PollingIntervalMinutes": 60,
    "EnablePolling": true,
    "MaxSubscriptionsPerPoll": 50,
    "TimeoutSeconds": 30,
    "StartupDelaySeconds": 30
  }
}
```

## ApiTokens

External API token configuration.

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `TmdbToken` | string | `""` | TMDB API Read Access Token (Bearer Token) |

> **Bangumi Token**: The Bangumi public API does not require authentication. The system uses anonymous access automatically.

**Example**:

```json
{
  "ApiTokens": {
    "TmdbToken": "eyJhbGciOiJIUzI1NiJ9..."
  }
}
```

## Auth

JWT authentication configuration.

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `JwtSecret` | string | (auto-generated by setup wizard) | JWT signing secret (do not modify manually) |
| `TokenExpirationDays` | int | `7` | Token validity period in days |

> The setup wizard automatically generates a strong random secret. Manual configuration is usually unnecessary.

## PreFetch

Data pre-fetch service configuration.

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| `Enabled` | bool | `true` | Enable scheduled pre-fetching |
| `ScheduleHour` | int | `3` | Hour of day to run pre-fetch (0–23, 24-hour) |
| `RunOnStartup` | bool | `true` | Run a pre-fetch immediately on startup |
| `MaxConcurrency` | int | `3` | Concurrent aggregation requests |

**Example**:

```json
{
  "PreFetch": {
    "Enabled": true,
    "ScheduleHour": 3,
    "RunOnStartup": true,
    "MaxConcurrency": 3
  }
}
```

## Complete Example

A full `appsettings.runtime.json` example:

```json
{
  "QBittorrent": {
    "Host": "localhost",
    "Port": 8080,
    "Username": "admin",
    "Password": "yourpassword",
    "Category": "anime",
    "DefaultSavePath": null,
    "UseAnimeSubPath": false,
    "PauseTorrentAfterAdd": false,
    "TimeoutSeconds": 30
  },
  "Mikan": {
    "BaseUrl": "https://mikanani.me",
    "PollingIntervalMinutes": 30,
    "EnablePolling": true,
    "MaxSubscriptionsPerPoll": 50,
    "TimeoutSeconds": 30,
    "StartupDelaySeconds": 30
  },
  "ApiTokens": {
    "TmdbToken": "your_tmdb_bearer_token"
  },
  "Auth": {
    "JwtSecret": "auto_generated_secret",
    "TokenExpirationDays": 7
  },
  "PreFetch": {
    "Enabled": true,
    "ScheduleHour": 3,
    "RunOnStartup": true,
    "MaxConcurrency": 3
  }
}
```

## Notes

- After editing the config file, restart the container: `docker compose restart`
- Changing `JwtSecret` invalidates all existing tokens — all users will need to log in again
- `appsettings.runtime.json` takes precedence over `appsettings.json`; all setup wizard changes are written to the former

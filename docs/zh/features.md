# 功能说明

## 每日放送

主页展示当天放送的动漫，数据从 Bangumi 实时获取，并通过 TMDB 和 AniList 补充英文元数据和横版背景图。

- 按星期显示放送计划，支持手动切换日期
- 每部动漫展示：竖版封面、评分、中英文标题
- 点击动漫卡片打开详情弹窗，包含：横版背景图、中英文简介、外部链接（Bangumi / TMDB / AniList / MAL）
- 数据在 sessionStorage 中缓存，刷新页面不重复请求

## Top 10 排行

主页同时展示三个数据源的 Top 10 排行，横向滚动卡片展示：

| 排行榜 | 数据来源 | 说明 |
|--------|----------|------|
| Bangumi Top 10 | Bangumi 评分排行 | 日本动漫评分权威数据库 |
| AniList Trending | AniList 趋势排行 | 基于近期观看和讨论热度 |
| MAL Top 10 | MyAnimeList via Jikan API | 全球最大动漫社区排行 |

## 搜索与资源

通过搜索功能找到想看的番剧资源：

1. 以 Mikan 为主搜索源，解析番剧 RSS 页面
2. 展示资源列表，可按以下条件筛选：
   - 分辨率（1080p / 720p / 4K）
   - 字幕类型（简中 / 繁中 / 多语言）
   - 字幕组
3. 一键发送到 qBittorrent 下载

## 订阅管理

订阅是自动下载的核心功能。每个订阅绑定一部番剧，系统定期检查 Mikan RSS，自动下载新资源。

### 创建订阅

在番剧详情页或搜索页面点击"订阅"按钮，配置以下选项：

| 选项 | 说明 |
|------|------|
| 番剧名称 | 显示名称 |
| Mikan 番剧 ID | 用于构建 RSS URL（从 Mikan 番剧页面获取） |
| 字幕组 | 指定特定字幕组（留空则接收全部） |
| 包含关键词 | 逗号分隔，资源标题必须包含这些词 |
| 排除关键词 | 逗号分隔，资源标题包含这些词则跳过 |

**示例**：订阅 ANi 字幕组的 1080p 简体中文资源

```
字幕组：ANi
包含关键词：1080p,简体
排除关键词：HEVC
```

### 订阅状态

| 状态 | 说明 |
|------|------|
| 已启用 | 后台轮询会处理该订阅 |
| 已禁用 | 暂停轮询，下载历史保留 |

### 手动检查

在订阅列表中点击"检查"按钮，立即触发一次 RSS 检查（无需等待下次定时轮询）。

## 自动下载

后台 `RssPollingService` 服务按照配置的间隔（默认 30 分钟）运行，处理所有已启用的订阅。

### 轮询流程

```
1. 检查 EnablePolling 是否为 true
2. 获取所有已启用的订阅
3. 对每个订阅：
   a. 向 Mikan 发送 RSS 请求
   b. 解析 XML，提取种子列表
   c. 按 TorrentHash 查询 DownloadHistory（去重）
   d. 对未下载的资源：
      - 匹配字幕组筛选
      - 关键词包含/排除过滤
   e. 将通过过滤的种子推送到 qBittorrent
   f. 记录到 DownloadHistory（防止重复下载）
   g. 更新订阅的 LastDownloadAt 和 DownloadCount
```

### 下载历史

每次下载都记录以下信息：

- 资源标题
- 种子哈希（唯一标识，防止重复）
- 文件大小
- 下载状态（待下载 / 下载中 / 完成 / 失败 / 跳过）
- 发现时间和下载时间

## 下载管理

查看 qBittorrent 中所有种子的状态：

- 种子名称、大小、进度
- 下载/上传速度
- 暂停 / 恢复 / 删除操作（同步到 qBittorrent）

## Web 设置

无需 SSH 或直接编辑配置文件，所有配置均可在浏览器中完成：

- **qBittorrent 连接**：主机/端口/账密，支持测试连接
- **TMDB Token**：填写或更新 API Token
- **轮询间隔**：修改 RSS 检查频率
- **语言切换**：中文/英文界面切换（持久化到 localStorage）
